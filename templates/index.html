<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
	
    <title>MonsterBorg</title>
    <meta name="Patrick Pinard" content="HTML5 & Bootstrap 4 !">
	<style>

		body
		{
		  margin: 0px;
		  padding: 0px;
		  font-family: monospace;
		}
		.row
		{
		  display: inline-flex;
		  clear: both;
		}
		.columnLateralsx
		{
		float: left;
		width: 15%;
		min-width: 400px;
		}
		.columnLateraldx
		{
		float: right;
		width: 15%;
		min-width: 400px;
		}
  
	  </style>
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">
	<script src="static/joy.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <!-- import Bootstrap CSS-->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/chartist.js/latest/chartist.min.css">

  </head>
  <body>
	<!-- Navigation -->
	<nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
		<div class="container">
			<a class="navbar-brand" href="#"> MonsterBorg Command Center </a>
			<span class="navbar-text">
			  welcome {{ user }}
			</span>
			<form method="POST" action="logout" class="center-block">
			  <button name="LOGOUT" type="submit" class="btn btn-secondary btn-secondary" value="LOGOUT"> LOGOUT </button>
			</form> 
		</div>	
	</nav>

	<p>&nbsp;</p> <p>&nbsp;</p> 
    
	<div class="container"> 
		<div class="btn-group-lg" role="group" >
			
			<form method="POST" action="/startstop" class="center-block">
				<button name="state" type="submit" class="btn btn-danger btn-lg" value="STOP">  STOP  </button> <b></b>
				<button name="state" type="submit" class="btn btn-primary btn-lg" value="START">  START </button>
			</form>
	<div class="row">
		<div class="col-md-4">
			<div class="columnLateralsx">
				<div id="speed" style="width:200px;height:200px;margin:20px"></div>
			</div>	
		</div>

		<div class="col-md-8">
			<img src="http://monsterborg.ppdlab.ch:5000/video_feed" width="100%" >
		</div>

		<div class="col-md-4">
			<div class="columnLateraldx">
				<div id="steering" style="width:200px;height:200px;margin:20px"></div>
			  </div>	
		</div>
	</div>

	<!-- /.container -->            
	<script type="text/javascript">
        
		// POSTer function uses ajax library to post data from joystick to the server
		
		function POSTer(toLolcalHosta, toLolcalHostb,toLolcalHostc, toLolcalHostd) {
		  formDATI = {
					"motorX": toLolcalHosta,
			  "motorY": toLolcalHostb,
			  "servoX" : toLolcalHostc,
			  "servoY" : toLolcalHostd
			};
		  
		  //	Transform data into JSON to be sent	
			var formData = JSON.stringify(formDATI);
		
		  //	Ajax Request
			$.ajax({
			type: "POST",							// Post method sends data whithoud showing in url
			url: window.location.href + "post",		// Link is taken from the location url added by "post" (flask POST route)
			data: formData,							// Data is JSON dataset
			success: function(){},
			dataType: "json",
		  contentType : "application/json",
		  secure: true, 
		  headers: {								// Header is made for CORS policy
			'Access-Control-Allow-Origin' : '*',
		  }
		
			});
		}
		
		
		// Create Joystick objects
		var Joy1 = new JoyStick('speed');
		var Joy2 = new JoyStick('steering');
		
		//Call POSTer function every 50ms, sending data acquired by the two joysticks 
		setInterval(function(){ 
		  joy1Xvar = Joy1.GetX();
		  joy1Yvar = Joy1.GetX();
		  joy2Xvar = Joy2.GetX();
		  joy2Yvar = Joy2.GetY(); 
		  POSTer(parseInt(joy2Xvar), parseInt(joy2Yvar), parseInt(joy1Xvar), parseInt(joy1Yvar)) 
		  }, 50);
		
	</script>
  </body>
</html>