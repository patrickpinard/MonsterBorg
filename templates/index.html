<!DOCTYPE html>
<html lang="en">
  	<head>

		<!-- format caractère européen avec accents -->
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">

		<!-- titre de l'onglet de la page web  -->
		<title>MonsterBorg</title>
			
		<!-- import joystick library and ajax-->
		<script src="static/joy.js"></script>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
		
		<!-- CSS templates bootstrap-->
		<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
		

  	</head>
  	<body>
		<!-- Navigation -->
		<nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
			<div class="container">
				<a class="navbar-brand" href="#"> MonsterBorg Command Center </a>
				<form method="POST" action="logout" class="center-block">
				<button name="LOGOUT" type="submit" class="btn btn-secondary btn-secondary" value="LOGOUT"> LOGOUT </button>
				</form> 
			</div>	
		</nav>

		<!-- sauts de lignes -->
		<p>&nbsp;</p> <p>&nbsp;</p> 
    
		<!-- container pour les boutons start & stop, la vidéo et le joystick-->

		<div class="container"> 
			<div class="row">
				<div class="col-sm-8">
					<div class="card">
						<h5 class="card-header">Live Streaming from PiCamera onboard</h5>
						<div class="card-body">
							<img src="http://monsterborg.ppdlab.ch:5000/video_feed" width="100%" >
						</div>
					</div>
					
				</div>

				<div class="col-sm-4">
					<div class="card">
						<h5 class="card-header">Joystick : speed & steering</h5>
						<div class="card-body">
							<div id="Steering" style="width:400px;height:400px;margin:20px"></div>
						</div>
					</div>
						
				</div>				
			</div>
		</div>
		<div class="container">
            <p>&nbsp;</p> 
            <div class="row my-4">
            <div class="col-12 col-md-6 col-lg-3 mb-4 mb-lg-0">
            <div class="card">
                <h5 class="card-header">Battery</h5>
                <div class="card-body">
                  <h5 class="card-title">{{ battery }}</h5>
                  <p class="card-text"> Level in Volts (min 9,4)</p>
                </div>
              </div>
            </div>
            <div class="col-12 col-md-6 mb-4 mb-lg-0 col-lg-3">
                <div class="card">
                    <h5 class="card-header">Communication</h5>
                    <div class="card-body">
                      <h5 class="card-title">{{ signal }}</h5>
                      <p class="card-text">Signal strenght</p>
                    </div>
                  </div>
            </div>
            <div class="col-12 col-md-6 mb-4 mb-lg-0 col-lg-3">
                <div class="card">
                    <h5 class="card-header">Process</h5>
                    <div class="card-body">
                      <h5 class="card-title">{{ cpu }}</h5>
                      <p class="card-text"> cpu usage % </p>  
                    </div>
                  </div>
            </div>
            <div class="col-12 col-md-6 mb-4 mb-lg-0 col-lg-3">
                <div class="card">
                    <h5 class="card-header">Motors</h5>
                    <div class="card-body">
                      <h5 class="card-title">state : {{ state }}</h5>
					  <p class="card-text"> Running or Stop Borg state </p>
                    </div>
                  </div>
            </div>
            </div>
          </div>  
		<!-- Footer -->
        <footer class="py-2 bg-dark">
            <div class="container">
                <p class="m-0 text-center text-white"> MonsterBorg Project v1.0 -  monsterborg.ppdlab.ch - mars 2021  </p>
            </div>
	        
		<script type="text/javascript	">
        
		// POSTer function uses ajax library to post data from joystick to the server
		
		function POSTer(x1,y1) {
		  Data = {
			"joy1_x" : x1,
			"joy1_y" : y1
			//"joy2_x" : x2,
			//"joy2_y" : y2
			};
		  
		  //	Transform data into JSON to be sent	
			var formData = JSON.stringify(Data);
		
		  //	Ajax Request
			$.ajax({
			type: "POST",							// Post method sends data whithoud showing in url
			url: window.location.href + "post",		// Link is taken from the location url added by "post" (flask POST route)
			data: formData,							// Data is JSON dataset
			success: function(){},
			dataType: "json",
		  contentType : "application/json",
		  secure: true, 
		  headers: {								// Header is made for CORS policy
			'Access-Control-Allow-Origin' : '*',
		  }
		
			});
		}
		
		
		// Create Joystick objects
		var Joy1 = new JoyStick('Steering');
		//var Joy2 = new JoyStick('Speed');
		
		//Call POSTer function every 50ms, sending data acquired by the two joysticks 
		setInterval(function(){ 
		  joy1Xvar = Joy1.GetX();
		  joy1Yvar = Joy1.GetY();
		  //joy2Xvar = Joy2.GetX();
		  //joy2Yvar = Joy2.GetY(); 
		  POSTer(parseInt(joy1Xvar), parseInt(joy1Yvar)) 
		  }, 50);
		
		</script>
	</body>
</html>