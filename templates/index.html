<!DOCTYPE html>
<html lang="en">
    <head>
        <!-- metadata -->
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <meta name="description" content="MonsterBorg Command Center">
        <meta name="author" content="Patrick Pinard">
        <title>MonsterBorg CommandCenter</title>
        <style>

          body
          {
            margin: 0px;
            padding: 0px;
            font-family: monospace;
          }
          .row
          {
            display: inline-flex;
            clear: both;
          }
          .columnLateralsx
          {
          float: left;
          width: 15%;
          min-width: 400px;
          }
          .columnLateraldx
          {
          float: right;
          width: 15%;
          min-width: 400px;
          }
    
        </style>
        <!-- import joystick library and ajax-->
        <script src="static/joy.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
        <!-- import Bootstrap CSS -->
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/chartist.js/latest/chartist.min.css">
    </head>

</html>
        <!-- Navigation -->
        <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
            <div class="container">
                <a class="navbar-brand" href="#"> MonsterBorg Command Center </a>
                <span class="navbar-text">
                  welcome {{ user }}
                </span><form method="POST" action="logout" class="center-block">
                  <button name="LOGOUT" type="submit" class="btn btn-secondary btn-secondary" value="LOGOUT"> LOGOUT </button>
                </form> 
                
        </nav>
        <!-- Page Content -->
        <div class="container">
          <div class="row">
            <div class="col">
            <p>&nbsp;</p> 
            <!-- Heading Row -->
            <div class="row align-items-center my-6">
                <div class="col-lg-12">
                    <p>&nbsp;</p> 
                     <img src="http://monsterborg.ppdlab.ch:5000/video_feed" width="70%" > 
                </div>
            </div>
          </div>
          <p>&nbsp;</p> 
          <p>&nbsp;</p> 
          <div class="col-lg-auto">
            <p>&nbsp;</p> 
            <form method="POST" action="/startstop">
                <div class="btn-group-lg" role="group" >
                <p>&nbsp;</p>
                <form method="POST" action="/startstop" class="center-block">
                    <button name="state" type="submit" class="btn btn-danger btn-lg" value="STOP">  STOP  </button> <b></b>
                    <button name="state" type="submit" class="btn btn-primary btn-lg" value="START">  START </button>
                </form>
                </div>
                <p>&nbsp;</p> 
                <p>&nbsp;</p> 
            </form>
            <p>&nbsp;</p> 
            
              <div class="columnLateralsx">
                <div id="speed" style="width:300px;height:300px;margin:100px"></div>
              </div>
          
          </div>
          <!-- Content Row -->
          <div class="container">
            <p>&nbsp;</p> 
              <div class="row my-4">
                <div class="col-12 col-md-6 col-lg-3 mb-4 mb-lg-0">
                      <p Battery : {{ battery }} </p>
                </div>
                <div class="col-12 col-md-6 mb-4 mb-lg-0 col-lg-3">
                      <p Signal : {{ signal }}</p>
                </div>
                <div class="col-12 col-md-6 mb-4 mb-lg-0 col-lg-3">
                  <p CPU : {{ cpu }}</p>
                </div>
                <div class="col-12 col-md-6 mb-4 mb-lg-0 col-lg-3">
                  <p  state : {{ state }}</p>
                  <p   left : {{ left }}  &nbsp &nbsp right : {{ right }}</p>
                </div>
              </div>
          </div>  
            <!-- /.row -->
                
        <!-- /.container -->
                
        <script type="text/javascript">
        
          // POSTer function uses ajax library to post data from joystick to the server
          
          function POSTer(toLolcalHosta, toLolcalHostb,toLolcalHostc, toLolcalHostd) {
            formDATI = {
                      "motorX": toLolcalHosta,
                "motorY": toLolcalHostb,
                "servoX" : toLolcalHostc,
                "servoY" : toLolcalHostd
              };
            
            //	Transform data into JSON to be sent	
              var formData = JSON.stringify(formDATI);
          
            //	Ajax Request
              $.ajax({
              type: "POST",							// Post method sends data whithoud showing in url
              url: window.location.href + "post",		// Link is taken from the location url added by "post" (flask POST route)
              data: formData,							// Data is JSON dataset
              success: function(){},
              dataType: "json",
            contentType : "application/json",
            secure: true, 
            headers: {								// Header is made for CORS policy
              'Access-Control-Allow-Origin' : '*',
            }
          
              });
          }
          
          
          // Create Joystick objects
          var Joy1 = new JoyStick('speed');
          var Joy2 = new JoyStick('steering');
          
          //Call POSTer function every 50ms, sending data acquired by the two joysticks 
          setInterval(function(){ 
            joy1Xvar = Joy1.GetX();
            joy1Yvar = Joy1.GetX();
            joy2Xvar = Joy2.GetX();
            joy2Yvar = Joy2.GetY(); 
            POSTer(parseInt(joy2Xvar), parseInt(joy2Yvar), parseInt(joy1Xvar), parseInt(joy1Yvar)) 
            }, 50);
          
              </script>
    <!-- Footer -->
    <footer class="py-2 bg-dark">
      <div class="container">
          <p class="m-0 text-center text-white"> MonsterBorg Project v1.0 -  monsterborg.ppdlab.ch - mars 2021  </p>
      </div>
  <!-- /.container -->
  </footer>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/5.0.0-alpha1/js/bootstrap.min.js" integrity="sha384-oesi62hOLfzrys4LxRF63OJCXdXDipiYWBnvTl9Y9/TRlw5xlKIEHpNyvvDShgf/" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/chartist.js/latest/chartist.min.js"></script>
    </body>
</html>
